@layer base {
    /* enable transitions */
    dialog,
    [popover],
    .react-aria-Modal {
        --dialog-transition-delay: 300ms;

        position: relative;
        display: flex; flex-direction: column;
        justify-content: space-between; gap: calc($gutter * 1.5);
        inline-size: $dialog-width; block-size: $dialog-height;
        padding: ($gutter * 2) ($gutter * 1.5) ($gutter * 1.5);
        background-color: $white; border: 1px solid transparent;
        border-radius: $border-radius-large;
        transition-behavior: allow-discrete;

        > section,
        article {
            flex: 1;
        }
    }

    dialog[data-upload-content="true"],
    .react-aria-Modal[data-upload-content="true"] {
        inline-size: 45rem; block-size: fit-content; gap: 1.25rem;

        > p {
            margin: 0 !important;
        }

        &[data-review-process="true"] {
            > div[data-btn-set="true"] {
                margin-block: 1rem !important;
            }
        }
    }

    dialog[data-project-create="true"],
    .react-aria-Modal[data-project-create="true"] {
        max-block-size: 60em; block-size: 50em; inline-size: 39.5em;
    }

    dialog[data-onboarding="true"],
    .react-aria-Modal[data-onboarding="true"] {
        inline-size: 98dvw; max-inline-size: 98dvw;
        block-size: fit-content; min-block-size: 90dvh; overflow: auto;
        box-shadow: $box-shadow-ultra; padding: 0.75rem;

        @include bp-min($medium) {
            inline-size: calc($dialog-width + 100px);
            min-block-size: calc($dialog-height + 180px);
            padding: 1.5rem 2rem;
        }
    }

    dialog[data-cookie-policy="true"],
    .react-aria-Modal[data-cookie-policy="true"] {
        @include styled-scrollbar($primary-color-light);
        position: relative; justify-content: flex-start;
        inline-size: 50dvw; block-size: 70dvh;
        padding-block-start: 0;

        > p {
            @include large-text;
            text-align: left;

            h2 {
                @include h3;
            }

            a {
                @include link;
                font-weight: $font-weight-regular;
                color: $grey-darker !important;

                transition: all 0.2s ease-in-out;

                @include hover {
                    color: $blue-dark !important;
                    background-color: transparent !important;
                    text-decoration: none;
                }
            }
        }
    }

    [popover],
    dialog,
    ::backdrop,
    .react-aria-ModalOverlay {
        z-index: -1;
        opacity: 0;
        transition:
            display var(--dialog-transition-delay) allow-discrete,
            overlay var(--dialog-transition-delay) allow-discrete,
            transform var(--dialog-transition-delay) allow-discrete,
            opacity var(--dialog-transition-delay);
    }


    dialog[data-variation="drawer"],
    .react-aria-Modal[data-variation="drawer"] {
        position: fixed; inset: 0 0 0 auto; outline: none;
        inline-size: $drawer-width; max-block-size: 100dvh;
        block-size: 100vh; margin-inline-end: 0;
        padding: 0; border-radius: 0; transform: translateX(0);

        > section[role="dialog"] {
            > section > form {
                overflow: auto;
            }
        }

        &[data-entering] {
            animation: mymodal-slide 200ms;
        }

        &[data-exiting] {
            animation: mymodal-slide 200ms reverse ease-in;
        }
    }
    // dialog#legislation-details-edit-modal-id form > header ul[data-tabs="true"] {
    //     gap: 0.025rem !important;
    // }

    dialog[open][data-variation="drawer"] {
        transform: translateX(0);
    }

    /* IN */
    :popover-open,
    :popover-open::backdrop,
    [open],
    [open]::backdrop,
    .react-aria-ModalOverlay {
        opacity: 1;
        // transform: translateY(-10px);
    }

    [open][data-onboarding="true"]::backdrop,
    .react-aria-ModalOverlay {
        background-color: transparent;
        backdrop-filter: unset;
    }

    /* OUT */
    @starting-style {
        :popover-open,
        :popover-open::backdrop,
        [open],
        [open]::backdrop,
        .react-aria-ModalOverlay {
            opacity: 0;
        }

        dialog, {
            transform: translateY(10px);
        }
    }
}

@layer base.support {
    html {
        color-scheme: dark light;
    }

    ::backdrop,
    .react-aria-ModalOverlay {
        background-color: #0005;
        backdrop-filter: blur(5px);
    }
}

.react-aria-ModalOverlay {
    position: absolute; inset: 0; z-index: 1000;
    inline-size: 100vw; block-size: 100dvh;
    background: rgba(0 0 0 / 0.4); backdrop-filter: blur(5px);
    display: flex; align-items: center; justify-content: center;

    &[data-entering] {
        animation: modal-fade 200ms;
    }

    &[data-exiting] {
        animation: modal-fade 200ms reverse ease-in;
    }
}

.react-aria-Modal {
    box-shadow: 0 8px 20px rgba(0 0 0 / 0.1);
    border-radius: calc($border-radius + 1px);
    background: $white; color: $text-color;
    border: 1px solid $border-color; outline: none;
    overflow: auto;

    header[data-policy-header="true"] {
        z-index: 1;
        display: flex; align-items: center; justify-content: space-between;
        position: sticky; top: 0; background-color: $white;  block-size: auto;
        padding-block: 1.5rem 1rem;

        > button {
            display: flex; align-items: center; justify-content: center;
            min-inline-size: 2rem; min-block-size: 2rem;
            position: absolute; top: 1rem; right: 0;
        }
    }

    &:not([data-variation="drawer"]) {
        &[data-entering] {
            animation: modal-zoom-in 200ms cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        &[data-exiting] {
            animation: fade-out 200ms ease-out;
        }
    }
}


@keyframes modal-fade {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@keyframes modal-zoom-in {
    from {
        transform: scale(0.95);
    }

    to {
        transform: scale(1);
    }
}

@keyframes fade-out {
    from {
        opacity: 1;
    }

    to {
        opacity: 0;
    }
}

@keyframes mymodal-blur {
    from {
        background: rgba(45 0 0 / 0);
        backdrop-filter: blur(0);
    }

    to {
        background: rgba(45 0 0 / .3);
        backdrop-filter: blur(10px);
    }
}

@keyframes mymodal-slide {
    from {
        transform: translateX(100%);
    }

    to {
        transform: translateX(0);
    }
}


section[role="dialog"] {
    position: relative; display: flex; flex-direction: column;

    section[data-drawer="true"] {
        form {
            padding: 0 ($gutter * 2) ($gutter * 1.5);
            display: flex; flex-direction: column; block-size: 100dvh;
        }

    }

    header[data-upload-header="true"] {
        padding-inline: 0; block-size: auto; display: flex; align-items: center;
        justify-content: space-between; margin-block-end: 1.25rem
    }
    header[data-upload-header="true"] > h2 {
        @include h2;
    }
    header[data-upload-header="true"] > h2 {
        font-weight: 500; margin: 0;
    }
    header[data-upload-header="true"] > button {
        min-inline-size: 3rem; display: flex; align-items: center;

        svg {
            transform: scale(1); transition: all 200ms ease-in-out;
        }

        @include hover {
            background-color: transparent;

            svg {
                fill: $error-color; transform: scale(1.1);
            }
        }
    }

    > header[data-project-create-header="true"] {
        display: flex; flex-direction: column; align-items: center;
        block-size: auto;

        > div:first-of-type {
            display: flex; flex-direction: column; align-items: center;
            margin-block: -1rem 1rem;
        }
    }

    > header[data-project-create-header="true"] > button {
        display: flex; align-items: center; align-self: flex-end;
        min-inline-size: 2rem; margin-block-start: -1rem; margin-inline-end: -1rem;
    }

    > header[data-project-create-header="true"] > div:first-of-type > h2 {
        margin: 0; text-align: center;
    }

    > header[data-project-create-header="true"] > div:first-of-type > p {
        max-inline-size: 400px; margin-block-end: 0.5rem; text-align: center;
    }
    > header[data-project-create-header="true"] > div:first-of-type > span:last-of-type::after {
        content: "*"; color: $error-color; font-size: 13px;
        opacity: 0.75; padding-inline-start: 0.3125rem;
    }

    > span[data-required="true"] {
        font-size: 13px; position: relative;
        text-align: left; padding-inline-start: 0.75rem;padding-block-end: 0;

        @include bp-min($medium) {
            font-size: 1rem;
        }

        &::before {
            font-size: 13px; content: '*'; color: $error-color;
            position: absolute; inset: -4px auto auto 0;

            @include bp-min($medium) {
                font-size: 1.3rem;
            }
        }
    }
}
